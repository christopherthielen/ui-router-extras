/** UI-Router Extras v.0.1.3 Module: sticky http://christopherthielen.github.io/ui-router-extras/ - MIT License */
!function(e,t){"use strict";function n(t,n){function a(t,n,a,r,f){function d(){var t={};return e.forEach(c,function(e,n){for(var a=m(e),r=0;r<a.length;r++){var i=a[r].parent;t[i.name]=t[i.name]||[],t[i.name].push(e)}t[""]&&(t.__inactives=t[""])}),t}function p(){var e={};return s(c,function(t){s(t.path,function(n){n!==t&&(e[n.name]=e[n.name]||[],e[n.name].push(t))})}),e}function m(e){var t=[];if(!e)return t;do e.sticky&&t.push(e),e=e.parent;while(e);return t.reverse(),t}function g(e,t,n,a){if(a)return"reload";var r=c[e.self.name];if(!r)return"enter";if(e.self===n)return"reload";var i=$(e.ownParams,t,r.locals.globals.$stateParams);return i?"reactivate":"reload"}function h(e,t){var n=c[e.name];if(!n)return null;if(!t)return n;var a=$(e.ownParams,t,n.locals.globals.$stateParams);return a?n:null}function $(e,t,n){return"function"==typeof e.$$equals?e.$$equals(t,n):x(t,n,e)}function x(t,n,a){if(!e.isArray(a)&&e.isObject(a)&&(a=o(a,["$$keys","$$values","$$equals","$$validates","$$new","$$parent"])),!a){a=[];for(var r in t)a.push(r)}for(var i=0;i<a.length;i++){var s=a[i];if(t[s]!=n[s])return!1}return!0}function b(e){var t=e.fromState.path,r=e.toState.path,o=e.toParams,s=0,u=r[s];for(e.options&&e.options.inherit&&(o=e.toParams=i(a,o||{},n.$current,e.toState));u&&u===t[s]&&$(u.ownParams,o,e.fromParams);)u=r[++s];return{keep:s,retained:t.slice(0,s),exiting:t.slice(s),entering:r.slice(s)}}function S(e,t){return e.name.split(".").length-t.name.split(".").length}var E={getInactiveStates:function(){return u(c,e.identity).sort(S)},getInactiveStatesByParent:function(){return d()},processTransition:function(t){function n(e){return function(t){return e.indexOf(t)===-1}}function a(e,t){return e.concat(t)}function r(e){return function(t){return t[e]}}function i(e){return function(t){return t.type===e}}function o(e){return function(t){return t.parent===e}}function s(e){return!e.sticky}var u,c,l,f=b(t),v=E.getInactiveStates(),d=f.keep,m=n(f.entering),h=f.exiting[0]&&f.exiting[0].sticky&&f.entering.length>0;c=f.exiting.map(function(e){var t=f.entering.indexOf(e)!==-1,n=h&&!t?"inactivate":"exit";return{type:n,state:e}});var $=t.options&&!!t.options.reload;l=f.entering.map(function(e){var n=g(e,t.toParams,t.reloadStateTree,$);return $=$||"reload"===n,{type:n,state:e}});var x=f.entering.map(function(e){return v.filter(o(e.parent))}).reduce(a,[]).filter(m).filter(s).concat(v.filter(o(t.toState))),y=p(),P=x.map(function(e){return y[e.name]}).filter(e.isDefined).reduce(a,[]).concat(x).sort(S),k=c.filter(i("exit")).map(r("state")).concat(P);return u=v.filter(n(k)).filter(n(f.entering)).concat(c.filter(i("inactivate")).map(r("state"))).sort(S),{keep:d,enter:new Array(d).concat(l.map(r("type"))),exit:new Array(d).concat(c.map(r("type"))),inactives:u,reactivatingStates:l.filter(i("reactivate")).map(r("state")),orphans:P}},stateInactivated:function(e){c[e.self.name]=e,e.self.status="inactive",e.self.onInactivate&&r.invoke(e.self.onInactivate,e.self,e.locals.globals)},stateReactivated:function(e){c[e.self.name]&&delete c[e.self.name],e.self.status="entered",e.self.onReactivate&&r.invoke(e.self.onReactivate,e.self,e.locals.globals)},stateExiting:function(t,n,a){var i={};e.forEach(n,function(e){i[e.self.name]=!0}),e.forEach(c,function(n,a){!i[a]&&n.includes[t.name]&&(v&&f.debug("Exiting "+a+" because it's a substate of "+t.name+" and wasn't found in ",i),n.self.onExit&&r.invoke(n.self.onExit,n.self,n.locals.globals),e.forEach(n.locals,function(e,t){delete l.locals[t]}),n.locals=null,n.self.status="exited",delete c[a])}),a&&r.invoke(a,t.self,t.locals.globals),t.locals=null,t.self.status="exited",delete c[t.self.name]},stateEntering:function(e,t,n,a){var i=h(e);if(i&&(a||!h(e,t))){var o=e.locals;this.stateExiting(i),e.locals=o}e.self.status="entered",n&&r.invoke(n,e.self,e.locals.globals)},reset:function(a,r){function i(e){E.reset(e)}if("*"===a)return e.forEach(E.getInactiveStates(),i),!0;var o=n.get(a);if(!o)return!1;var s=h(o,r);return!!s&&(E.stateExiting(s),t.$broadcast("$viewContentLoading"),!0)}};return E}var r=n,i=r.inheritParams,o=(r.objectKeys,r.protoKeys),s=r.forEach,u=r.map,c={},f={},v=!1;this.registerStickyState=function(e){f[e.name]=e},this.enableDebug=this.debugMode=function(t){return e.isDefined(t)&&(v=t),v},this.$get=a,a.$inject=["$rootScope","$state","$stateParams","$injector","$log"]}function a(e){return{resolve:{},locals:{globals:u&&u.locals&&u.locals.globals},views:{},self:{},params:{},ownParams:d.hasParamSet?{$$equals:function(){return!0}}:[],surrogateType:e}}function r(e){s=e}function i(n,r,i,o,p){function m(n,r,p){return u=n.$current,x[""]=u,u.parent=l,l.parent=t,l.locals=b(v,l.locals),u.locals=b(l.locals,u.locals),delete l.locals.globals,P=n.transitionTo,n.transitionTo=function(t,m,$){function b(t){var n=e.extend(new a("reactivate_phase1"),{locals:t.locals});return n.self=e.extend({},t.self),n}function y(t){var n=e.extend(new a("reactivate_phase2"),t),r=n.self.onEnter;return n.resolve={},n.views={},n.self.onEnter=function(){n.locals=t.locals,s.stateReactivated(t)},V.addRestoreFunction(function(){t.self.onEnter=r}),n}function k(e){var t=new a("inactivate");t.self=e.self;var n=e.self.onExit;return t.self.onExit=function(){s.stateInactivated(e)},V.addRestoreFunction(function(){e.self.onExit=n}),t}function w(e,t){var n=e.self.onEnter;return e.self.onEnter=function(){s.stateEntering(e,t,n)},V.addRestoreFunction(function(){e.self.onEnter=n}),e}function F(e,t){var n=e.self.onEnter;return e.self.onEnter=function(){s.stateEntering(e,t,n,!0)},V.addRestoreFunction(function(){e.self.onEnter=n}),e}function R(e){var t=e.self.onExit;return e.self.onExit=function(){s.stateExiting(e,J,t)},V.addRestoreFunction(function(){e.self.onExit=t}),e}var T=i.debugMode();l.locals||(l.locals=u.locals);var j=f.length;c&&(c(),T&&r.debug("Restored paths from pending transition"));var I,_,O,q,A=n.$current,C=n.params,M=$&&$.relative||n.$current,B=n.get(t,M),D=[],J=[];m=m||{},arguments[1]=m;var K=function(){},V=function(){I&&(L.path=I,I=null),_&&(A.path=_,_=null),e.forEach(V.restoreFunctions,function(e){e()}),V=K,c=null,f.splice(j,1)};if(V.restoreFunctions=[],V.addRestoreFunction=function(e){this.restoreFunctions.push(e)},B){var L=x[B.name];if(L){I=L.path,_=A.path;var N=$&&$.reload||!1,U=N&&(N===!0?I[0].self:n.get(N,M));$&&N&&N!==!0&&delete $.reload;var z={toState:L,toParams:m||{},fromState:A,fromParams:C||{},options:$,reloadStateTree:U};if(f.push(z),c=V,U){z.toParams.$$uirouterextrasreload=Math.random();var G=U.$$state().params,H=U.$$state().ownParams;if(d.hasParamSet){var Q=new o.Param("$$uirouterextrasreload");G.$$uirouterextrasreload=H.$$uirouterextrasreload=Q,V.restoreFunctions.push(function(){delete G.$$uirouterextrasreload,delete H.$$uirouterextrasreload})}else G.push("$$uirouterextrasreload"),H.push("$$uirouterextrasreload"),V.restoreFunctions.push(function(){G.length=G.length-1,H.length=H.length-1})}O=s.processTransition(z),T&&g(r,z,O);var W=L.path.slice(0,O.keep),X=A.path.slice(0,O.keep);e.forEach(l.locals,function(e,t){t.indexOf("@")!=-1&&delete l.locals[t]});var Y=function(e){return function(t,n){n.indexOf("@")!==-1&&(e[n]=t)}};S(O.inactives,function(e){S(e.locals,Y(l.locals))}),S(O.reactivatingStates,function(e){S(e.locals,Y(v))}),V.addRestoreFunction(function(){S(v,function(e,t){delete v[t]})}),e.forEach(O.enter,function(e,t){var n,a=L.path[t];"reactivate"===e?(n=b(a),W.push(n),X.push(n),D.push(y(a)),q=a):"reload"===e?(W.push(F(a)),q=a):"enter"===e&&W.push(w(a))}),e.forEach(O.exit,function(e,t){var n=A.path[t];"inactivate"===e?(X.push(k(n)),J.push(n)):"exit"===e&&(X.push(R(n)),J.push(n))}),D.length&&e.forEach(D,function(e){W.push(e)});var Z=O.orphans;X=X.concat(E(Z,function(e){return R(e)})),J=J.concat(Z),A.path=X,L.path=W;var ee=function(e){return(e.surrogateType?e.surrogateType+":":"")+e.self.name};T&&r.debug("SurrogateFromPath: ",E(X,ee)),T&&r.debug("SurrogateToPath:   ",E(W,ee))}}var te=P.apply(n,arguments);return te.then(function(e){return V(),T&&h(r,x[e.name],n),e.status="active",e},function(e){return V(),T&&"transition prevented"!==e.message&&"transition aborted"!==e.message&&"transition superseded"!==e.message&&(r.debug("transition failed",e),r.debug(e.stack)),p.reject(e)})},n}function g(t,n,a){function r(e,t,n){return e[t]?e[t].toUpperCase()+": "+n.self.name:"("+n.self.name+")"}var i=E(a.inactives,function(e){return e.self.name}),o=E(n.toState.path,function(e,t){return r(a.enter,t,e)}),u=E(n.fromState.path,function(e,t){return r(a.exit,t,e)}),c=n.fromState.self.name+": "+e.toJson(n.fromParams)+":  -> "+n.toState.self.name+": "+e.toJson(n.toParams);t.debug("------------------------------------------------------"),t.debug("   Current transition: ",c),t.debug("Before transition, inactives are:   : ",E(s.getInactiveStates(),function(e){return e.self.name})),t.debug("After transition,  inactives will be: ",i),t.debug("Transition will exit:  ",u),t.debug("Transition will enter: ",o)}function h(e,t,n){e.debug("Current state: "+t.self.name+", inactive states: ",E(s.getInactiveStates(),function(e){return e.self.name}));for(var a=function(e,t){return"globals"!=t&&"resolve"!=t},r=function(e){var t=y(e.locals,a);return Object.keys(t).length||(t[""]={$$state:{name:null}}),E(t,function(t,n){return{localsFor:e.self.name?e.self.name:"(root)",uiViewName:n||null,filledByState:t.$$state.name}})},i=r(t),o=t.parent;o&&o!==t;)i=i.concat(r(o)),t=o,o=t.parent;e.debug("Views active on each state:"),console.table(i.reverse())}var $=p,x=$.internalStates,b=$.inherit,S=($.inheritParams,$.forEach),E=$.map,y=$.filterObj;d.hasParamSet=!!o.ParamSet,l=e.extend(new a("__inactives"),{self:{name:"__inactives"}}),u=c=t,f=[],p.onStateRegistered(function(e){e.self.sticky===!0&&i.registerStickyState(e.self)});var P;m.$inject=["$delegate","$log","$q"],n.decorator("$state",m)}e.module("ct.ui.router.extras.sticky",["ct.ui.router.extras.core"]);var o=e.module("ct.ui.router.extras.sticky");n.$inject=["$stateProvider","uirextras_coreProvider"],o.provider("$stickyState",n);var s,u,c,l,f=[],v={},d={hasParamSet:!1};r.$inject=["$stickyState"],e.module("ct.ui.router.extras.sticky").run(r),i.$inject=["$provide","$stateProvider","$stickyStateProvider","$urlMatcherFactoryProvider","uirextras_coreProvider"],e.module("ct.ui.router.extras.sticky").config(i)}(angular);
/** UI-Router Extras v.0.0.13 Module: future http://christopherthielen.github.io/ui-router-extras/ - MIT License */
!function(t){"use strict";!function(t,e){function r(e,r,n,a){function o(e,r){var n=t.isObject(e)?e.name:e;return r?h[n]:l[n]}function u(t,e){if(e.name){var r=e.name.split(/\./);for("."===e.name.charAt(0)&&(r[0]=t.current.name);r.length;){var n=r.join(".");if(t.get(n,{relative:t.current}))return null;if(h[n])return h[n];r.pop()}}if(e.url){var a=[];for(var o in h){var u=h[o].urlMatcher;u&&u.exec(e.url)&&a.push(h[o])}for(var i=a.slice(0),c=a.length-1;c>=0;c--)for(var f=0;f<i.length;f++)a[c]===i[f].parentFutureState&&a.splice(c,1);return a[0]}}function i(t,e){p=!0;var r=t.get("$q");if(!e){var n=r.defer();return n.reject("No lazyState passed in "+e),n.promise}var a=r.when([]),o=e.parentFutureState;o&&h[o.name]&&(a=i(t,h[o.name]));var u=e.type,c=v[u];if(!c)throw Error("No state factory for futureState.type: "+(e&&e.type));return a.then(function(r){var n=t.invoke(c,c,{futureState:e});return n.then(function(t){return t&&r.push(t),r})})["finally"](function(){delete h[e.name]})}function c(t,r){var n=!1,a=["$rootScope","$urlRouter","$state",function(a,o,c){function s(){n=!0,o.sync(),n=!1}if(!$)return f().then(s),void($=!0);var l=u(c,{url:r.path()});return l?void i(t,l).then(function(t){t.forEach(function(t){t&&(!c.get(t)||t.name&&!c.get(t.name))&&e.state(t)}),p=!1,s()},function(){p=!1,s()}):t.invoke(d)}];if(!p){var o=n?d:a;return t.invoke(o)}}var f,s=a,l=s.internalStates,v={},h={},p=!1,m=[],$=!1,g=this;this.addResolve=function(t){m.push(t)},this.stateFactory=function(t,e){v[t]=e},this.futureState=function(e){e.stateName&&(e.name=e.stateName),e.urlPrefix&&(e.url="^"+e.urlPrefix),h[e.name]=e;var r,a=e.name.split(/\./).slice(0,-1).join("."),u=o(e.parent||a);if(u)r=u.url||u.navigable.url;else if(""===a)r=n.compile("");else{var i=o(e.parent||a,!0);if(!i)throw new Error("Couldn't determine parent state of future state. FutureState:"+t.toJson(e));var c=i.urlMatcher.source.replace(/\*rest$/,"");r=n.compile(c),e.parentFutureState=i}e.url&&(e.urlMatcher="^"===e.url.charAt(0)?n.compile(e.url.substring(1)+"*rest"):r.concat(e.url+"*rest"))},this.get=function(){return t.extend({},h)};var d=["$log","$location",function(t,e){t.debug("Unable to map "+e.path())}];r.otherwise(c),r.otherwise=function(e){if(t.isString(e)){var n=e;e=function(){return n}}else if(!t.isFunction(e))throw new Error("'rule' must be a function");return d=["$injector","$location",e],r};var S={getResolvePromise:function(){return f()}};this.$get=["$injector","$state","$q","$rootScope","$urlRouter","$timeout","$log",function(r,n,a,o,c,s,l){function v(){if(o.$on("$stateNotFound",function(t,a,o,c){if(!p){l.debug("event, unfoundState, fromState, fromParams",t,a,o,c);var f=u(n,{name:a.to});if(f){t.preventDefault();var s=i(r,f);s.then(function(t){t.forEach(function(t){t&&(!n.get(t)||t.name&&!n.get(t.name))&&e.state(t)}),n.go(a.to,a.toParams),p=!1},function(t){console.log("failed to lazy load state ",t),n.go(o,c),p=!1})}}}),!f){var v=[];t.forEach(m,function(t){v.push(r.invoke(t))}),f=function(){return a.all(v)}}f().then(function(){s(function(){n.transition?n.transition.then(c.sync,c.sync):c.sync()})})}return v(),S.state=e.state,S.futureState=g.futureState,S.get=g.get,S}]}var n=t.module("ct.ui.router.extras.future",["ct.ui.router.extras.core"]);r.$inject=["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","uirextras_coreProvider"],n.provider("$futureState",r);var a={state:function(t){a.$rootScope&&a.$rootScope.$broadcast("$stateAdded",t)},itsNowRuntimeOhWhatAHappyDay:function(t){a.$rootScope=t},$rootScope:e};n.config(["$stateProvider",function(e){var r=e.state;e.state=function(){var n=r.apply(e,arguments),o=t.isObject(arguments[0])?arguments[0]:arguments[1];return a.state(o),n}}]),n.run(["$futureState",function(t,e){a.itsNowRuntimeOhWhatAHappyDay(e)}])}(t)}(angular);